# CubeDiff

CubeDiff is a Bash tool for comparing volumetric data in cube files. It computes the difference between two cube files' grid data while preserving the header. Optionally, it can also split the difference data into two separate files—one with only positive values (negative values set to zero) and one with only negative values (positive values set to zero).

**Note:** CubeDiff has been tested with cube files generated by Q-Chem. It is not guaranteed to work with cube files generated by ORCA.

## Features

- **Header Preservation:**  
  The tool automatically detects and preserves the cube file header (which includes atom count, origin, and grid information).

- **Data Difference Calculation:**  
  It computes the difference for each corresponding grid point as:

  ```
  (value from file2.cube) - (value from file1.cube)
  ```

- **Optional Data Separation:**  
  With the `--separate` flag, the tool creates two additional files:
  - `diff_positive.cube` — retains positive values only (all negative values are set to 0).
  - `diff_negative.cube` — retains negative values only (all positive values are set to 0).

## Installation

Clone the repository and make the script executable:

```
git clone https://github.com/Markus-G-S-Weiss/CubeDiff.git
cd CubeDiff
chmod +x cubediff.sh
```

## Usage

Display the help message:

```
./cubediff.sh --help
```

### Basic Difference Calculation

Compute the difference between two cube files:

```
./cubediff.sh file1.cube file2.cube
```

This command creates a file `diff.cube` that contains the header (from `file1.cube`) and the computed differences for the volumetric data.

### Separate Positive and Negative Data

To additionally produce separate files for positive and negative differences:

```
./cubediff.sh --separate file1.cube file2.cube
```

This command produces:
- `diff.cube` — The main difference file.
- `diff_positive.cube` — A file where negative values are replaced with 0.
- `diff_negative.cube` — A file where positive values are replaced with 0.

## How It Works

1. **Header Extraction:**  
   The script determines the header length based on the cube file format (6 plus the number of atoms provided on the third line). The header is copied unchanged.

2. **Data Difference Calculation:**  
   The volumetric grid data is extracted from both files and processed line-by-line. Each corresponding pair of grid values is subtracted (file2 minus file1) and printed in scientific notation.

3. **Optional Data Separation:**  
   When the `--separate` flag is provided, the tool uses `awk` to process the resulting `diff.cube`:
   - In `diff_positive.cube`, negative values are set to 0.
   - In `diff_negative.cube`, positive values are set to 0.

## Requirements

- Bash shell (tested with Bash 4+)
- Standard Unix utilities: `awk`, `head`, `tail`, `paste`
- Cube files generated by Q-Chem (CubeDiff has not been tested with cube files from ORCA)

## Contributing

Contributions are welcome! Feel free to fork the repository and submit pull requests for improvements or bug fixes.

## License

This project is licensed under the GNU General Public License v3.0. See the [LICENSE](LICENSE) file or [GPL-3.0](https://www.gnu.org/licenses/gpl-3.0.en.html) for details.

## Contact

For questions or comments, please open an issue or contact Markus-G-S-Weiss on GitHub.

